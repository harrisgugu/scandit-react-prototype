var Z=Object.defineProperty;var ee=(a,e,t)=>e in a?Z(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var i=(a,e,t)=>(ee(a,typeof e!="symbol"?e+"":e,t),t);var B=async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11]));var _=()=>(async a=>{try{return typeof MessageChannel<"u"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(a)}catch(e){return!1}})(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]));function te(){return typeof crossOriginIsolated>"u"?!1:crossOriginIsolated}function re(){try{return new WebAssembly.Memory({initial:1,maximum:1,shared:!0}).buffer.constructor.name==="SharedArrayBuffer"}catch(a){return!1}}async function N(){return B()}async function ae(){if(!await _())return!1;let e=null;try{e=new Worker(URL.createObjectURL(new Blob(['postMessage("Worker" in self);'],{type:"text/javascript"})),{name:"nestedWorkerTest"})}catch(t){return!1}return new Promise(t=>{if(e==null){t(!1);return}e.onmessage=r=>{e==null||e.terminate(),t(r.data)}})}async function H(){let a=await ae();return te()&&re()&&a}var u;(s=>{let a;(m=>(m.Debug="debug",m.Info="info",m.Warn="warn",m.Error="error",m.Quiet="quiet"))(a=s.Level||(s.Level={}));let e=new Map([["debug",1],["info",2],["warn",3],["error",4],["quiet",5]]),t="debug";function r(d){t=d}s.setLevel=r;function n(d,...o){if(!(e.get(t)>e.get(d)))switch(d){case"debug":console.debug(...o);break;case"info":console.log(...o);break;case"warn":console.warn(...o);break;case"error":console.error(...o);break;default:break}}s.log=n})(u||(u={}));var U={};function ne(a){return[...new Uint8Array(a)].map(e=>{let t=e.toString(16);return t.length===1?`0${t}`:t}).join("")}async function T(a,e,t){if(typeof crypto.subtle.digest!="function")return u.log(u.Level.Warn,`Insecure context (see https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts): The hash of the Scandit Data Capture library WASM file found at ${t} could not be verified`),"NOT_VERIFIABLE";try{let r=a instanceof Promise?await a:a,n=await crypto.subtle.digest("SHA-256",r),s=ne(n);return e==null?(u.log(u.Level.Warn,"The library hash is not defined or empty, cannot correctly verify integrity."),"NOT_VERIFIABLE"):s===e?(u.log(u.Level.Debug,"Data Capture library WASM integrity has been verified correctly."),"VALID"):(u.log(u.Level.Warn,`The Scandit Data Capture library WASM file found at ${t} seems invalid: expected file hash doesn't match (received: ${s}, expected: ${e}). Please ensure the correct Scandit Data Capture file (with correct version) is retrieved.`),"INVALID")}catch(r){return"NOT_VERIFIABLE"}}var I=new Map([["br",4.4],["gzip",2.9],["none",1]]);function se(a){var r;let e="content-encoding";if(a==null||a.get(e)==null)return I.get("none");let t=new Set(((r=a.get(e))!=null?r:"").split(",").map(n=>n.trim()));for(let[n,s]of I)if(t.has(n))return s;return I.get("none")}function oe(a){var r,n;if(a==null)return 0;let e=(r=se(a))!=null?r:1,t=Number.parseInt((n=a.get("content-length"))!=null?n:"0",10);return Number.isNaN(t)?0:Math.floor(t*e*100)/100}function ie(a){let{pathname:e}=new URL(a);for(let[t,r]of Object.entries(U))if(e.endsWith(t))return r.bytes;return 0}function V(a){U=a}var de=(a,e)=>{let t=oe(e);return t===0?ie(a):t};function ue(a,e,{onProgress:t,onError:r,onComplete:n}){let{body:s,status:d,statusText:o,headers:l}=e.clone();if(!s)return e;let p=de(a,l),c=0,m=0,g=s.getReader(),h=new ReadableStream({async start(C){async function D(){try{let{done:f,value:w}=await g.read();if(f){C.close(),t==null||t({percentage:100,loadedBytes:c,privateUri:a}),n==null||n({percentage:100,loadedBytes:c,privateUri:a});return}c+=w.length,p>0&&w.length>0&&m<100?(m=Number((c/p*100).toFixed(2)),t==null||t({percentage:m,loadedBytes:c,privateUri:a})):p===0&&w.length>0&&(t==null||t({percentage:null,loadedBytes:c,privateUri:a})),C.enqueue(w),await D()}catch(f){throw r==null||r({error:f}),f}}return D()}});return new Response(h,{headers:new Headers(l),status:d,statusText:o})}async function k({wasmURI:a,awaitFullResponse:e,onProgress:t}){let r=await fetch(a);if(!r.ok)throw new Error(`HTTP status code is not ok: ${r.status}, ${r.statusText}`);return new Promise((n,s)=>{let d=ue(a,r,{onProgress:t,onError:({error:o})=>{s(o)},onComplete:()=>{e&&n(d)}});e||n(d)})}function z(a,e,t,r,n){async function s(o){try{let p=await(o!=null?o:await k({wasmURI:e,awaitFullResponse:!0,onProgress:n})).arrayBuffer();T(p,t,e);let c=await globalThis.WebAssembly.instantiate(p,a);r(c.instance,c.module)}catch(l){u.log(u.Level.Error,l),u.log(u.Level.Error,`Couldn't instantiate Scandit SDK DataCapture library at ${e}, did you configure the path for it correctly?`)}}async function d(){let o;try{o=await k({wasmURI:e,awaitFullResponse:!1,onProgress:n});let l=await globalThis.WebAssembly.instantiateStreaming(o,a);r(l.instance,l.module),T(k({wasmURI:e,awaitFullResponse:!0}).then(async p=>p.arrayBuffer()),t,e)}catch(l){u.log(u.Level.Warn,l),u.log(u.Level.Warn,"WebAssembly streaming compile failed. Falling back to ArrayBuffer instantiation (this will make things slower)"),s((o==null?void 0:o.bodyUsed)===!0?void 0:o)}}typeof globalThis.WebAssembly.instantiateStreaming=="function"?d():s()}async function F(a,e,t,r){return new Promise((n,s)=>{a().then(n).catch(d=>{let o=e*2;if(o>t){s(d);return}r(d),globalThis.setTimeout(()=>{F(a,o,t,r).then(n).catch(s)},e)})})}var S=class{constructor(){i(this,"promise");i(this,"resolve");i(this,"reject");this.promise=new Promise((e,t)=>{this.reject=t,this.resolve=e})}};var y=class extends Error{constructor(t){super(t.message);i(this,"name");i(this,"message");Object.setPrototypeOf(this,y.prototype),typeof t.name=="string"&&(this.name=t.name),typeof t.message=="string"&&(this.message=t.message)}};var L=Promise.resolve(),A=!1,E=!1,x,v={writableDataPathPreload:"",writableDataPath:"",preloading:!1};async function ce(){let a="FILE_DATA",e,t,r,n,s;function d(){clearTimeout(s),r.result.close(),n.result.close(),e(0)}function o(){try{let l=[],p=r.result.transaction(a,"readonly");p.addEventListener("error",d),p.addEventListener("abort",d);let c=p.objectStore(a).openCursor();c.onsuccess=()=>{let m=c.result;if(m==null)try{let g=0,h=n.result.transaction(a,"readwrite"),C=h.objectStore(a);h.addEventListener("error",d),h.addEventListener("abort",d),h.oncomplete=()=>{clearTimeout(s),r.result.close(),n.result.close(),e(g)};for(let D of l){let f=C.count(D.primaryKey);f.onsuccess=()=>{f.result===0&&(++g,C.add(D.value,D.primaryKey))},clearTimeout(s),s=globalThis.setTimeout(()=>{u.log(u.Level.Warn,"IndexedDB database is blocked! Resetting Scandit Data Capture library..."),t(new y({name:"BlockedIndexedDB",message:"IndexedDB database is blocked"}))},500)}}catch(g){d.call({error:g})}else{let{writableDataPathPreload:g,writableDataPath:h}=v;l.push({value:m.value,primaryKey:m.primaryKey.toString().replace(`${g}/`,`${h}/`)}),m.continue()}},c.onerror=d}catch(l){d.call({error:l})}}return new Promise((l,p)=>{let{writableDataPathPreload:c,writableDataPath:m}=v;e=l,t=p,r=indexedDB.open(c),r.onupgradeneeded=()=>{try{r.result.createObjectStore(a)}catch(g){}},r.onsuccess=()=>{if(!Array.from(r.result.objectStoreNames).includes(a)){l(0);return}n=indexedDB.open(m),n.onupgradeneeded=()=>{try{n.result.createObjectStore(a)}catch(g){}},n.onsuccess=()=>{o()},n.onblocked=n.onerror=d},r.onblocked=r.onerror=d})}async function $(a,e){let{preloading:t}=v;if(x!=null){if(A=!0,!t&&a){let r=await ce();if(!e&&r===0){A=!1;return}}await new Promise((r,n)=>{x==null||x(a,s=>{if(A=!1,s!=null){n(s);return}r()})})}}async function q(a,e=!1,t=!1){return(!E||t)&&(A?(E=!0,L=L.then(async()=>(E=!1,$(a,e)))):L=$(a,e)),L}async function j(a){v=a,x=FS.syncfs,FS.syncfs=(e,t)=>{let r=t,n=s=>{r(s)};q(e).then(n).catch(n)};try{FS.mkdir(v.writableDataPath)}catch(e){if(e.code!=="EEXIST")throw x=void 0,e}return FS.mount(IDBFS,{},v.writableDataPath),q(!0,!0)}var P;(e=>{function a(){let t="6.19.1";if(t==null)throw new y({name:"Invalid library version",message:"Library version is not defined or empty."});return t}e.sdkVersion=a})(P||(P={}));function me(a){return/^https?:\/\/(?:[^./]*\.)*cdn.jsdelivr.net\//.test(a)?{result:!0,cdnBaseURL:"https://cdn.jsdelivr.net/npm/"}:/^https?:\/\/(?:[^./]*\.)*unpkg.com\//.test(a)?{result:!0,cdnBaseURL:"https://unpkg.com/"}:{result:!1,cdnBaseURL:""}}function ge(a){let t=/scandit-web-datacapture-[a-z]+/i.exec(a);return t?t[0]:null}function G(a,e,t){let r=e,n=me(r);if(n.result){let d=ge(r);d!=null&&(r=`${n.cdnBaseURL}${d}@${a}/build/engine/`)}let s=t.replace(".wasm","");return n.result?{jsURI:`${r}${s}.js`,wasmURI:`${r}${s}.wasm`}:{jsURI:`${r}${s}.js?v=${a}`,wasmURI:`${r}${s}.wasm?v=${a}`}}async function he(a,e){async function t(){return importScripts(a)}try{await F(t,250,4e3,n=>{u.log(u.Level.Warn,n),u.log(u.Level.Warn,`Couldn't retrieve Scandit Data Capture library at ${a}, retrying...`)}),self.Module.mainScriptUrlOrBlob=a;let r=globalThis.SDC_WASM_JS_VERSION;return r!==e&&u.log(u.Level.Warn,`The Scandit Data Capture library JS file found at ${a} seems invalid: expected version doesn't match (received: ${r}, expected: ${e}). Please ensure the correct Scandit Data Capture file (with correct version) is retrieved.`),!0}catch(r){return u.log(u.Level.Error,r),!1}}var R=class{constructor(e,t){i(this,"context");i(this,"lastUsedModuleMirrorAxis");i(this,"view");i(this,"MAX_NUMBER_OF_IMAGES_IN_FRAME_DATA_POOL",10);i(this,"moduleHandler");i(this,"redrawInterval",1e3/30);i(this,"redrawRequests",[]);i(this,"workerFunctions");i(this,"_isDrawLoopRunning",!1);i(this,"contextDeserializer");i(this,"frameDataPool",new Map);i(this,"imageFrameSource");i(this,"lastFrameCounter",-1);i(this,"libraryLoadingPromise");i(this,"loopTimeoutId");i(this,"resourcePath");i(this,"writableDataPath");i(this,"poorMansBenchmarkLogs",!1);i(this,"writableDataPathPreload","/scandit_sync_folder_preload");i(this,"writableDataPathStandard","/scandit_sync_folder");i(this,"resourceFilesSubfolder","resources");i(this,"performanceMetricsReporterTimer");i(this,"performanceMetrics",{frameDataPoolSize:0,processedFramesCount:0,redrawRequestsCount:0,actualRedrawsCount:0});i(this,"gestureRecognizer");i(this,"gestureListener",null);this.moduleHandler=e,this.workerFunctions=t,this._loadProgressCallback=this._loadProgressCallback.bind(this),V(this.getWasmMetadata())}get Module(){return this.moduleHandler.get()}set isDrawLoopRunning(e){this._isDrawLoopRunning=e,!e&&typeof this.loopTimeoutId=="number"&&(clearTimeout(this.loopTimeoutId),this.loopTimeoutId=void 0)}get isDrawLoopRunning(){return this._isDrawLoopRunning}setPoorMansBenchmarkLogs(e){this.poorMansBenchmarkLogs=e}convertToLoadableFrameData(e){let t=this.getNextFrameId();this.frameDataPool.set(t,new Uint8ClampedArray(e.getFrameData()));let r=this.lastUsedModuleMirrorAxis!=null?this.lastUsedModuleMirrorAxis!==this.Module.Axis.None:!1;return{frameId:t,width:e.getWidth(),height:e.getHeight(),isFrameSourceMirrored:r}}createContext(e){var l,p;let t=this.getModeDeserializers();this.contextDeserializer=new this.Module.DataCaptureContextDeserializer(this.writableDataPath,e.deviceId,e.context.deviceModelName,e.domain,t,e.delayedRegistration,e.highEndBlurryRecognition,this.resourcePath);let r=this.contextDeserializer.contextFromJson(JSON.stringify(e.context)),n=r.getView();this.context=r.getContext(),r.delete();let s=this.Module.DataCaptureContextListener.extend("DataCaptureContextListener",{didChangeStatus:(c,m)=>{this.contextDidChangeStatus(JSON.parse(m.toJson()))},didStartObservingContext:()=>{this.didStartObservingContext()}}),d=this.Module.GestureRecognizer.extend("GestureRecognizer",{setGestureListener:(c,m)=>{var g;(g=this.gestureListener)==null||g.delete(),this.gestureListener=c.clone()}});(l=this.gestureRecognizer)==null||l.delete(),this.gestureRecognizer=new d;let o=new s;this.context.addListener(o),o.delete(),this.setView(n),(p=this.view)==null||p.setGestureRecognizer(this.gestureRecognizer)}onTap(e){var t;(t=this.gestureListener)==null||t.onTap(JSON.stringify(e))}startReportingPerformanceMetrics(){this.performanceMetricsReporterTimer==null&&(this.performanceMetricsReporterTimer=setInterval(()=>{this.reportPerformanceMetrics();for(let e of Object.keys(this.performanceMetrics))this.performanceMetrics[e]=0},1e3))}async reportPerformanceMetrics(){this.workerFunctions.postMessage({type:"performanceMetricsReport",payload:{...this.performanceMetrics}})}deleteFrameData(e){this.frameDataPool.delete(e)}dispose(){var e,t;this.context.dispose(),this.frameDataPool.clear(),this.isDrawLoopRunning=!1,this.lastFrameCounter=-1,(e=this.gestureRecognizer)==null||e.delete(),this.gestureRecognizer=null,(t=this.gestureListener)==null||t.delete(),this.gestureListener=null}extractCentaurusLicense(e){return{payload:{centaurus:{licenseKey:this.Module.LicenseUtils.getBlinkIdLicenseKey(e)}}}}getModeDeserializers(){return new this.Module.VectorDataCaptureModeDeserializer}loadLibrary(e){return this.libraryLoadingPromise!=null?this.libraryLoadingPromise:(this.libraryLoadingPromise=this.setup(e),this.libraryLoadingPromise)}processFrame(e){var n;if(this.context==null)return{payload:e,transferables:[e.data.buffer]};let t=e.data,r=this.Module.allocateUint8Array(t.byteLength);return this.Module.HEAPU8.set(t,r),(n=this.imageFrameSource)==null||n.outputFrame(r,e.width,e.height,this.Module.ImageBufferFormat.Rgba8888),{payload:e,transferables:[e.data.buffer]}}reportCameraProperties(e){this.context.setCameraProperties(e.deviceId,e.isFrontFacing,e.hasAutofocus)}requestFrameData(e){let t=this.frameDataPool.get(e);return t==null?{payload:{data:null}}:{payload:{data:t},transferables:[t.buffer]}}scheduleRedraw(e,t){this.addRedrawRequest(t),this.isDrawLoopRunning||this.startDrawLoop(e)}sendViewRefreshCommands(e){this.workerFunctions.postMessage({type:"draw",payload:e})}setFrameSource(e){var t;this.lastUsedModuleMirrorAxis=this.mapMirrorAxisOnModule(e),(t=this.imageFrameSource)==null||t.delete(),this.imageFrameSource=new this.Module.ImageBufferFrameSource(this.lastUsedModuleMirrorAxis),this.context.setFrameSource(this.imageFrameSource)}startDrawLoop(e){this.isDrawLoopRunning=!0;let t=s=>this.redrawRequests.length>0&&this.redrawRequests[0]<=s,r=s=>{for(;this.redrawRequests.length>0&&this.redrawRequests[0]<=s;)this.redrawRequests.shift()},n=()=>{this.loopTimeoutId=setTimeout(()=>{if(!this.isDrawLoopRunning)return;let s=performance.now();t(s)&&(r(s),e.draw(),this.sendViewRefreshCommands(JSON.parse(e.getDrawCommands()))),n()},this.redrawInterval)};n()}updateContext(e){if(this.context!=null&&this.contextDeserializer!=null){let t=this.contextDeserializer.updateContextFromJson(this.context,this.view,JSON.stringify(e.context));this.context.delete(),this.context=t.getContext();let r=t.getView();t.delete(),r!=null&&e.view!=null&&r.setViewSize(e.view.width,e.view.height),this.gestureRecognizer!=null&&(r==null||r.setGestureRecognizer(this.gestureRecognizer)),this.setView(r),u.log(u.Level.Debug,"context updated",e)}}getNextFrameId(){return this.lastFrameCounter++,this.lastFrameCounter>=this.MAX_NUMBER_OF_IMAGES_IN_FRAME_DATA_POOL&&(this.lastFrameCounter=0),this.lastFrameCounter}getWasmDynamicLibraries(e){return this.getWasmSideModuleFileName()==null?[]:[`${e.replace(/\/[^/]*$/,"/")}${this.getWasmSideModuleFileName()}`]}getWasmCoreExpectedHash(e,t){return t?e?globalThis.SDC_WASM_CORE_MT_SIMD_HASH:globalThis.SDC_WASM_CORE_MT_HASH:e?globalThis.SDC_WASM_CORE_SIMD_HASH:""}getWasmCoreFileName(e,t){return t?e?globalThis.SDC_WASM_CORE_MT_SIMD_FILE_NAME:globalThis.SDC_WASM_CORE_MT_FILE_NAME:e?globalThis.SDC_WASM_CORE_SIMD_FILE_NAME:""}getWasmMetadata(){return globalThis.WASM_METADATA}getWasmSideModuleFileName(){return""}_loadProgressCallback(e){this.workerFunctions.postMessage({type:"loadLibraryProgress",payload:e})}addRedrawRequest(e){this.redrawRequests.push(Math.round(performance.now())+e),this.redrawRequests.sort((t,r)=>t-r)}contextDidChangeStatus(e){var t,r;if(e.code===260){let n;if((t=location.href)!=null&&t.startsWith("blob:null/"))n="localhost";else{let s=((r=location.pathname)==null?void 0:r.length)>1&&!location.pathname.startsWith("/");n=new URL(s?location.pathname:location.origin).hostname}n.startsWith("[")&&n.endsWith("]")&&(n=n.slice(1,-1)),e.message=e.message.replace("domain name",`domain name (${n})`)}this.workerFunctions.postMessage({type:"contextDidChangeStatus",payload:e})}didStartObservingContext(){this.workerFunctions.postMessage({type:"didStartObservingContext"})}mapMirrorAxisOnModule(e){switch(e){case"None":return this.Module.Axis.None;case"X":return this.Module.Axis.X;case"Y":return this.Module.Axis.Y;default:return this.Module.Axis.None}}setView(e){this.view=e,this.setViewRefreshHandler(e),e==null&&(this.isDrawLoopRunning=!1,this.sendViewRefreshCommands([]))}setViewRefreshHandler(e){if(e==null||e.isViewRefreshHandlerSet)return;let t=this.Module.NeedsRedrawDelegate.extend("NeedsRedrawDelegate",{setNeedsRedrawIn:this.scheduleRedraw.bind(this,e)}),r=new t;e.setNeedsRedrawDelegate(r),e.isViewRefreshHandlerSet=!0}setupDataDecoding(){let e=this.moduleHandler.get(),t=e.DataDecoding.extend("DataDecoding",{decode(r,n){try{let s=JSON.parse(n),d=[];for(let o of s){let l=new TextDecoder(o.ianaName,{fatal:!0});d.push(l.decode(r.slice(o.startIndex,o.endIndex)))}return d.join("")}catch(s){return""}}});e.setDataDecoding(new t)}start(e,t,r){e&&t&&(this.setupDataDecoding(),this.moduleHandler.get().callMain(),typeof this.moduleHandler.get().PThread=="object"||r())}getWritableDataPath(e,t){return e?this.writableDataPathPreload:t!=null?(u.log(u.Level.Debug,`IndexedDB database name override in use to recover from blocked standard database: ${t}`),t):this.writableDataPathStandard}async setup({libraryLocation:e,locationPath:t,preloadEngine:r,writableDataPathOverride:n,overrideThreadsSupport:s,overrideSimdSupport:d}){var O;let o=!1,l=!1;this.writableDataPath=this.getWritableDataPath(r,n),this.resourcePath=`${e}${this.resourceFilesSubfolder}/`,globalThis.path=t;let{resolve:p,reject:c,promise:m}=new S,g=P.sdkVersion();if(g==="")throw new y({name:"Invalid library version",message:"Library version is not defined or empty, cannot generate proper path to library files."});let[h,C]=await Promise.all([N(),H()]);s!=="auto"&&(C=s==="on"),d!=="auto"&&(h=d==="on");let D=G(g,e,this.getWasmCoreFileName(h,C)),{jsURI:f}=D,{wasmURI:w}=D;return this.moduleHandler.set({mainScriptUrlOrBlob:f,canvas:(O=this.workerFunctions.getOffscreenCanvas())!=null?O:{getContext:()=>null},instantiateWasm:(b,Q)=>(z(b,w,this.getWasmCoreExpectedHash(h,C),Q,this._loadProgressCallback),{}),dynamicLibraries:this.getWasmDynamicLibraries(w),locateFile:b=>e+b,noInitialRun:!0,preRun:[async()=>{try{await j({writableDataPathPreload:this.writableDataPathPreload,writableDataPath:this.writableDataPath,preloading:r})}catch(b){if(b.name==="BlockedIndexedDB"){c(b.toString());return}u.log(u.Level.Debug,"No IndexedDB support, some data will not be persisted:",b)}l=!0,this.start(l,o,p)}],onMainComplete:()=>{if([o,l].includes(!1)){u.log(u.Level.Warn,{runtimeLoaded:o,fileSystemSynced:l},"Both runtimeLoaded and fileSystemSynced should be true when calling onMainComplete"),c("onMainComplete has been called but runtime or file system was not ready.");return}p()},onRuntimeInitialized:()=>{o=!0,this.start(l,o,p)},print:b=>{this.poorMansBenchmarkLogs&&(u.log(u.Level.Info,b),this.workerFunctions.postMessage({type:"console",payload:b}))}}),await he(f,g)||c(`Couldn't retrieve Scandit Data Capture library at ${f}, did you configure the path for it correctly?`),m}};function J(a){console.warn("Reached unexpected case",a)}function W(a){return typeof a=="object"&&a!=null}function K(a){if(typeof a=="string")return a;if(W(a)){if(typeof a.message=="string")return a.message}else if(typeof(a==null?void 0:a.toString)=="function")return a.toString();return"unknow error"}var M=class{constructor(e,t){i(this,"dataCaptureInstance");i(this,"workerSelf");!M.isWorkerScope(e)||(this.workerSelf=e,this.dataCaptureInstance=new R(t,{postMessage:this.postMessage.bind(this),getOffscreenCanvas:this.getOffscreenCanvas.bind(this)}),this.listenToMessages())}static isWorkerScope(e){return typeof e<"u"&&e.document==null}listenToMessages(){this.workerSelf.onmessage=this.onMessage.bind(this)}postMessage(e,t){this.workerSelf.postMessage(e,t!=null?t:[])}getOffscreenCanvas(){if(typeof this.workerSelf.OffscreenCanvas=="function")return new this.workerSelf.OffscreenCanvas(32,32)}hasPayload(e){return W(e)&&"payload"in e}hasTransferables(e){return W(e)&&Array.isArray(e.transferables)}async respondWith(e,t,r){let n=null,s;try{s=r(),s instanceof Promise&&(s=await s)}catch(o){s=void 0,n=K(o)}let d={type:"workerTaskId",command:e,id:t,payload:this.hasPayload(s)?s.payload:void 0};n!=null&&(d.error=n),this.postMessage(d,this.hasTransferables(s)?s.transferables:[])}onMessage(e){switch(e.data.command){case"loadLibrary":{let{data:t}=e;this.respondWith(t.command,t.id,async()=>this.dataCaptureInstance.loadLibrary({libraryLocation:t.libraryLocation,locationPath:t.locationPath,preloadEngine:t.preloadEngine,writableDataPathOverride:t.writableDataPathOverride,overrideThreadsSupport:t.overrideThreadsSupport,overrideSimdSupport:t.overrideSimdSupport}))}break;case"onTap":{let{data:t}=e;this.respondWith(t.command,t.id,async()=>{this.dataCaptureInstance.onTap(t.point)})}break;case"createContext":{let{data:t}=e;this.respondWith(t.command,t.id,()=>this.dataCaptureInstance.createContext({context:t.context,deviceId:t.deviceId,domain:t.domain,delayedRegistration:t.delayedRegistration,highEndBlurryRecognition:t.highEndBlurryRecognition}))}break;case"setFrameSource":{let{data:t}=e;this.respondWith(t.command,t.id,()=>this.dataCaptureInstance.setFrameSource(t.mirrorAxis))}break;case"processFrame":{let{data:t}=e;this.respondWith(t.command,t.id,()=>this.dataCaptureInstance.processFrame({data:t.data,width:t.width,height:t.height}))}break;case"requestFrameData":{let{data:t}=e;this.respondWith(t.command,t.id,()=>this.dataCaptureInstance.requestFrameData(t.frameId))}break;case"deleteFrameData":{let{data:t}=e;this.respondWith(t.command,t.id,()=>{this.dataCaptureInstance.deleteFrameData(t.frameId)})}break;case"updateContext":{let{data:t}=e;this.respondWith(t.command,t.id,async()=>this.dataCaptureInstance.updateContext(t))}break;case"dispose":this.respondWith(e.data.command,e.data.id,()=>this.dataCaptureInstance.dispose());break;case"reportCameraProperties":{let{data:t}=e;this.respondWith(t.command,t.id,async()=>this.dataCaptureInstance.reportCameraProperties(t))}break;case"setLogLevel":{let{data:t}=e;this.respondWith(t.command,t.id,()=>{u.setLevel(t.level)})}break;case"setPoorMansBenchmarkLogs":{let{data:t}=e;this.respondWith(t.command,t.id,()=>{this.dataCaptureInstance.setPoorMansBenchmarkLogs(t.enable)})}break;case"extractCentaurusLicense":{let{data:t}=e;this.respondWith(t.command,t.id,()=>this.dataCaptureInstance.extractCentaurusLicense(t.licenseKey))}break;default:return J(e.data),!1}return!0}},ot=new M(globalThis,{get:()=>globalThis.Module,set:a=>{globalThis.Module=a}}),fe="js/worker.js";var X=fe;var be=(t=>(t.Body="body",t.Footnote="footnote",t))(be||{}),ye=(r=>(r.Start="start",r.Center="center",r.End="end",r))(ye||{}),Ce=(r=>(r.Normal="normal",r.Wider="wider",r.FitText="fitText",r))(Ce||{}),De=(t=>(t.Normal="normal",t.Taller="taller",t))(De||{}),we=(t=>(t.Square="square",t.Rounded="rounded",t))(we||{}),xe=(t=>(t.None="none",t.Check="check",t))(xe||{});var ve=(r=>(r.Auto="auto",r.Off="off",r.On="on",r))(ve||{}),Y=class{constructor(e,t,r,n,s){i(this,"overrideThreadsSupport","auto");i(this,"overrideSimdSupport","auto");i(this,"_dataCaptureWorker");i(this,"libraryLocation");i(this,"isPreloadEngine");i(this,"workerCommandId",1);i(this,"workerTasks",new Map);i(this,"workerListeners",[]);i(this,"workerMessageListener");this.libraryLocation=e,this.isPreloadEngine=t,this.workerMessageListener=this.onWorkerMessage.bind(this),this.dataCaptureWorker.addEventListener("message",this.workerMessageListener),this.overrideThreadsSupport=r,this.overrideSimdSupport=n,typeof s=="function"&&this.addWorkerListener(d=>{d.type==="loadLibraryProgress"&&s(d.payload)})}get dataCaptureWorker(){var e;return(e=this._dataCaptureWorker)!=null||(this._dataCaptureWorker=new Worker(X)),this._dataCaptureWorker}static async create(e){var r,n;let t=new this(e.libraryLocation,(r=e.preloadEngine)!=null?r:!1,e.overrideThreadsSupport,e.overrideSimdSupport,e.loadProgressNotifier);return await t.workerCommand("setLogLevel",{level:(n=e.logLevel)!=null?n:u.Level.Debug}),await t.load(),t}async load(){var e;try{await this.workerCommand("loadLibrary",{libraryLocation:this.libraryLocation,locationPath:window.location.pathname,preloadEngine:this.isPreloadEngine,writableDataPathOverride:(e=localStorage.getItem("scanditWritableDataPathOverride"))!=null?e:void 0,overrideThreadsSupport:this.overrideThreadsSupport,overrideSimdSupport:this.overrideSimdSupport})}catch(t){if(t!=null&&typeof t=="object"&&typeof t.error=="string"&&t.error.includes("BlockedIndexedDB"))return await this.terminateDataCaptureWorker(!1),this.dataCaptureWorker.addEventListener("message",this.workerMessageListener),localStorage.setItem("scanditWritableDataPathOverride",`/scandit_sync_folder_${[...crypto.getRandomValues(new Uint32Array(2))].map(r=>r.toString(32)).join("")}`),this.load();throw t}}async workerCommand(e,t,r){return new Promise((n,s)=>{let d=this.workerCommandId++;this.workerTasks.set(d,{resolve:n,reject:s,command:e});let o={...t,command:e,id:d};this.dataCaptureWorker.postMessage(o,r)})}async terminateDataCaptureWorker(e=!0){var t,r;e&&await this.workerCommand("dispose",{}),(t=this._dataCaptureWorker)==null||t.removeEventListener("message",this.workerMessageListener),(r=this._dataCaptureWorker)==null||r.terminate(),this._dataCaptureWorker=void 0}addWorkerListener(e){this.workerListeners.push(e)}removeWorkerListener(e){!this.workerListeners.includes(e)||this.workerListeners.splice(this.workerListeners.indexOf(e),1)}onWorkerMessage(e){var r;let t=e.data;if(t.type==="console")(r=globalThis.workerConsole)==null||r.call(globalThis,t.payload);else if(t.type==="workerTaskId"&&typeof t.id=="number"){let{id:n,error:s,payload:d}=t,o=this.workerTasks.get(n);s!=null?o==null||o.reject(t):o==null||o.resolve(d),this.workerTasks.delete(n)}else for(let n of this.workerListeners)n(t)}};export{R as DataCaptureEngine,Y as DataCaptureLoader,we as HintCornerStyle,be as HintFont,De as HintHeight,xe as HintIcon,ye as HintTextAlignment,Ce as HintWidth,ve as OverrideState,M as WorkerMain,ot as workerInstance};
//# sourceMappingURL=worker.js.map
